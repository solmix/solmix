<?xml version="1.0" encoding="UTF-8"?>
<!-- * ========THE SOLMIX PROJECT===================================== * 
	* This is free software; you can redistribute it and/or modify it under the 
	terms of the GNU Lesser General Public License as published by the Free Software 
	Foundation; either version 2.1 of the License, or (at your option) any later 
	version. This software is distributed in the hope that it will be useful, 
	but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
	or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License 
	for more details. you may not use this file except in compliance with the 
	License. You may obtain a copy of the License at http://www.gnu.org/licenses/ 
	or see the FSF site: http://www.fsf.org. -->
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0"
	xmlns:ext="http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.0.0">

	<bean id="fileRepo" class="com.solmix.fmk.repo.FileSystemRepository"
		init-method="init" destroy-method="close">
		<property name="location"  value="${repo.location}" />
		<property name="sysLocation" value="${repo.syslocation}" />
	</bean>
	<bean id="dstracker" class="com.solmix.fmk.repo.DSRepositoryTracker"
		init-method="init" destroy-method="close" />

	<reference-list id="repo" interface="com.solmix.api.repo.DSRepository"
		availability="optional">
		<reference-listener ref="dstracker" bind-method="register"
			unbind-method="unregister" />
	</reference-list>


	<service interface="com.solmix.api.repo.DSRepositoryManager">
		<bean class="com.solmix.fmk.repo.DSRepositoryManagerImpl">
			<property name="tracker" ref="dstracker"></property>
			<property name="defaultRepo" ref="fileRepo" />
		</bean>
	</service>
	<!-- Allow usage of System properties, especially the karaf.base property -->
	<ext:property-placeholder placeholder-prefix="$["
		placeholder-suffix="]" />

	<cm:property-placeholder persistent-id="com.solmix.framework.dsrepo">
		<cm:default-properties>
		    <!-- 
		    <cm:property name="repo.location" value="$[karaf.base]/datasource" />
			<cm:property name="repo.syslocation" value="$[karaf.base]/datasource/system/schema" /> 
			-->
			<cm:property name="repo.location" value="$[solmix.base]/datasource" />
			<cm:property name="repo.syslocation" value="$[solmix.base]/datasource/system/schema" />
		</cm:default-properties>
	</cm:property-placeholder>

</blueprint>
