<?xml version="1.0" encoding="UTF-8"?>
	<!--

		* ========THE SOLMIX PROJECT===================================== * *
		This is free software; you can redistribute it and/or modify it under
		the terms of the GNU Lesser General Public License as published by the
		Free Software Foundation; either version 2.1 of the License, or (at
		your option) any later version. This software is distributed in the
		hope that it will be useful, but WITHOUT ANY WARRANTY; without even
		the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
		PURPOSE. See the GNU Lesser General Public License for more details.
		you may not use this file except in compliance with the License. You
		may obtain a copy of the License at http://www.gnu.org/licenses/ or
		see the FSF site: http://www.fsf.org.
	-->
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0"
	xmlns:ext="http://aries.apache.org/blueprint/xmlns/blueprint-ext/v1.0.0"
	xmlns:slx="http://www.solmix.com/xmlns/config/v1.0.0">
	
	
	<bean id="manager" class="org.solmix.web.servlets.SLXServices">
		<property name="shiroConfigIniManager" ref="shiroIni"></property></bean>
	
	<reference id="ds-cm" interface="org.solmix.fmk.config.ConfigRealm"
		filter="(org.solmix.service.cm=solmix-ds)" >
		<reference-listener ref="manager" bind-method="register_cm"	unbind-method="unregister_cm" />
	</reference>
	<reference id="ds-manager"
		interface="org.solmix.services.datasource.DataSourceManagerService" >
		<reference-listener ref="manager" bind-method="register_dsm"	unbind-method="unregister_dsm" />
	</reference>
	<reference id="prc-manager"
		interface="org.solmix.services.rpc.RPCManagerFactory">
		<reference-listener ref="manager" bind-method="register_rpcm"	unbind-method="unregister_rpcm" />
	</reference>
	 <reference id="compression"
		interface="org.solmix.services.interfaces.CompressionService"
		availability="optional">
		<reference-listener ref="manager"
			bind-method="register_compressionService"
			unbind-method="unregister_compressionService" />
	</reference> 
	<bean id="shiroIni" class="org.solmix.web.security.ShiroConfigIniManager">
		<property name="loginUrl" value="${loginUrl}"></property>
		<property name="successUrl" value="${successUrl}"></property>
		<property name="unauthorizedUrl" value="${unauthorizedUrl}"></property>
		<property name="securityManager" ref="securityManager"></property>
		<property name="filterChainDefinitions" value="${filterChainDefinitions}"></property>
	</bean>
	<bean id="jdbcRealm" class="org.solmix.web.security.realm.JdbcRealm">
		<property name="dataSourceFilter" value="${jdbcRealm.datasource.jndiosgi}"></property></bean>
	<bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager">
		<property name="realm" ref="jdbcRealm"></property>
	</bean>
	    <cm:property-placeholder persistent-id="org.solmix.service.cm.security" >
        <cm:default-properties>
        	<cm:property name="loginUrl" value="login.jsp"></cm:property>
        	<cm:property name="successUrl" value="Solmix.html"></cm:property>
        	<cm:property name="unauthorizedUrl" value="logout.jsp"></cm:property>
        	<cm:property name="jdbcRealm.datasource.jndiosgi"	value="(osgi.jndi.service.name=jdbc/NoTxHsqlDataSource)"></cm:property>
        	<cm:property name="filterChainDefinitions">
        	<value>/*.html=authc</value>
        	</cm:property>
        </cm:default-properties>
        </cm:property-placeholder>
        
        
         <slx:config-bundle name="solmix-security" >
        <slx:module name="security" flags="required">
        <slx:cm class="org.solmix.web.security.ShiroConfigModule" >
         loginUrl=${loginUrl}
         successUrl=${successUrl}
         unauthorizedUrl =${unauthorizedUrl}
         jdbcRealm.datasource.jndiosgi=${jdbcRealm.datasource.jndiosgi}
         filterChainDefinitions=${filterChainDefinitions}
        </slx:cm>
        </slx:module>
        </slx:config-bundle>
</blueprint>
